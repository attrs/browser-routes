function normalize(t,e){if(!t||"string"!=typeof t)throw new TypeError("illegal url");var r=(e||document).createElement("a");return r.href=t,{href:r.href,protocol:r.protocol,hostname:r.hostname,port:r.port,pathname:r.pathname,fullpath:r.pathname+(r.search?r.search:"")+(r.hash?r.hash:""),search:r.search,hash:r.hash,host:r.host}}function config(t,e){var r=document.head.querySelector('meta[name="'+t+'"][content]');return r&&r.getAttribute("content")||e}function current(t){return"hash"===t?location.hash:location.href}function endsWith(t,e){var r=t.toLowerCase().indexOf(e);return r>0&&r===t.length-e.length}function parseQuery(t){t=t.trim(),"?"===t[0]&&(t=t.substring(1));for(var e,r=/\+/g,n=/([^&=]+)=?([^&]*)/g,o=function(t){return decodeURIComponent(t.replace(r," "))},u={};e=n.exec(t);){var i=o(e[1]),s=o(e[2]);Array.isArray(u[i])?u[i].push(s):u[i]?(u[i]=[u[i]]).push(s):u[i]=s}return u}function defaultChecker(){var t=document.currentScript||document._currentScript;return function(){return t&&t.ownerDocument&&t.ownerDocument.documentElement&&t.ownerDocument.documentElement.contains(t)}}function addEventListener(t,e,r,n){t.attachEvent?t.attachEvent(e,r):t.addEventListener(e,r,n)}function match(t,e){return t===e}function capture(t){return JSON.parse(JSON.stringify(t))}function chain(t,e,r,n,o){var u,i=0;return u=function(s){var h=n[i++];if(s||!h)return o(s);var a=h.uri,f=h.type,c=h.fn;if("use"===f&&a){a&&"/"===a.trim()&&(a="");var l=e.purl||"",p=e.url;e.purl=path.join(l,p.substring(0,a.length)),e.url=p.substring(a.length)||"/",c.apply(t,[e,r,u]),e.purl=l,e.url=p}else c.apply(t,[e,r,u])}}function redirector(t){return function(e,r,n){r.redirect(t)}}function Router(t){t=t||"unknwon";var e=!0,r=[],n={},o=function(t,n,u){u=u||function(){};var i=[];r.forEach(function(r){if(e||!r.boot)if("use"===r.type){if("/"===r.uri||!t.url.indexOf(r.uri)||match(t.url,r.uri))return i.push(r)}else if("get"===r.type&&match(t.url,r.uri))return i.push(r)}),t.boot=e,chain(o,t,n,i,u)(t.error),e=!1};return o.exists=function(t){var e=!1;return r.forEach(function(r){if("get"===r.type&&match(t,r.uri))return e=!0;if("use"===r.type&&r.uri&&!t.indexOf(r.uri)){if("function"!=typeof r.fn.exists)return e=match(t,r.uri);e=r.fn.exists(t.substring(r.uri.length))}}),e},o.use=function(t,e){if("function"==typeof t&&(e=t,t=null),t&&"string"!=typeof t)throw new TypeError("illegal type of uri:"+typeof t);if("string"==typeof e&&(e=redirector(e)),"function"!=typeof e)throw new TypeError("illegal type of router:"+typeof e);return t=t?t.trim():"/","/"!==t[0]&&(t="/"+t),r.push({type:"use",uri:t,fn:e}),this},o.get=function(t,e){if("string"!=typeof t)throw new TypeError("illegal type of uri:"+typeof t);if("string"==typeof e&&(e=redirector(e)),"function"!=typeof e)throw new TypeError("illegal type of router:"+typeof e);return t=t?t.trim():"/","/"!==t[0]&&(t="/"+t),r.push({type:"get",uri:t,fn:e}),this},o.boot=function(t){if("function"!=typeof t)throw new TypeError("illegal type of router:"+typeof t);return r.push({type:"use",boot:!0,fn:t}),this},o.notfound=function(t){return o.on("notfound",t),this},o.error=function(t){return o.on("error",t),this},o.drop=function(t){var e=[];return r.forEach(function(r){r.fn===t&&e.push(r)}),e.forEach(function(t){r.splice(r.indexOf(t),1)}),this},o.clear=function(){return r=[],this},o.on=function(t,e){return n[t]=n[t]||[],n[t].push(e),this},o.once=function(t,e){var r=function(n){return o.off(t,r),e.call(this,n)};return o.on(t,r),this},o.off=function(t,e){var r=n[t];if(r)for(var o;~(o=r.indexOf(e));)r.splice(o,1);return this},o.fire=function(t,e){return"error"!==t||n[t]&&isteners[t].length?void(n[t]||[]).forEach(function(r){r.call(this,{type:t,detail:e||{}})}):console.error("[routes] error",e)},o}function Routes(t){if(!(this instanceof Routes))throw new Error("illegal state: 'new Routes()' instead of 'Routes()'");t=t||{};var e,r,n,o="",u=Router("root");this.config=function(e,r){var n=t;return 1===arguments.length?n(e):(null===r?delete n[e]:n[e]=r,this)},this.base=function(t){return arguments.length?t?(o=path.dirname(path.resolve(t,"index.html")),this):(o="",this):o},this.router=function(t){return Router(t)},this.normalize=function(t){return t=t.trim(),t?"/"===t[0]?o+t:normalize(t).fullpath:o};var i=this.exec=function(t){var s=normalize(t),h=s.hash,a=s.search,f=s.pathname,c=s.fullpath;if(!e||!e.requestURL||c!==e.requestURL){if(o&&f.startsWith(o))f=f.substring(o.length);else if(o)return console.error("given url is not a sub url of base url '"+o+"'");return n=[],e={method:"get",parsed:s,baseURL:o,requestURL:c,url:f,hashname:h,query:parseQuery(a),params:{}},r={redirect:function(t){return t.startsWith("#")?location.href=t:i(t.startsWith("/")?path.join(o,t):path.join(o,e.purl,e.url,t)),u.fire("redirect",{requestURL:c,url:f,request:e,response:r}),this},hash:function(t,e){n.push({hash:t,fn:e})}},u.fire("request",{requestURL:c,url:f,request:e,response:r}),u(e,r),this}};this.exechash=function(){return this},this.use=function(t,e){return u.use.apply(u,arguments),this},this.boot=function(t){return u.boot(t),this},this.get=function(t,e){return u.get(t,e),this},this.notfound=function(t){return u.notfound(t),this},this.error=function(t){return u.error(t),this},this.drop=function(t){return u.drop(t),this},this.exists=function(t){return u.exists(t)},this.clear=function(){return u.clear(),this},this.on=function(t,e){return u.on(t,e),this},this.once=function(t,e){return u.once(t,e),this},this.off=function(t,e){return u.off(t,e),this}}var path=require("path"),routes=new Routes;routes.Routes=Routes,routes.Router=Router,function(){function t(){function t(t){return t.__routes_managed__||(t.__routes_managed__=!0,addEventListener(t,"click",function(e){e.preventDefault(),routes.href(t.getAttribute("href"))})),this}function e(){return[].forEach.call(document.querySelectorAll("[routes], [data-routes]"),t),this}n&&n.disconnect(),n=new MutationObserver(function(e){e.forEach(function(e){[].forEach.call(e.addedNodes,function(e){1===e.nodeType&&(e.hasAttribute("routes")&&t(e),e.hasAttribute("data-routes")&&t(e),e.querySelectorAll&&[].forEach.call(e.querySelectorAll("[routes], [data-routes]"),t))})})}),n.observe(document.body,{childList:!0,subtree:!0}),e(),routes.exec(location.href)}var e=config("routes.mode")||(history.pushState?"pushstate":"hash");if("pushstate"===e){if(!history.pushState)return console.error("[routes] unsupported 'history.pushState'");var r=history.pushState;history.pushState=function(t,e,n){r.apply(history,arguments),routes.exec(location.href)},window.onpopstate=function(t){routes.exec(location.href)},routes.on("request",function(t){normalize(location.href).fullpath!==normalize(t.detail.requestURL).fullpath&&r.call(history,null,null,t.detail.requestURL)}),routes.href=function(t){history.pushState(null,null,routes.normalize(t))}}else if("hash"===e){if(!("onhashchange"in window))return console.error("[routes] unsupported 'onhashchange'");addEventListener(window,"hashchange",function(){routes.exec(location.hash)}),routes.on("redirect",function(t){location.href="#"+t.detail.url}),routes.href=function(t){location.href="#"+routes.normalize(t)}}var n;document.body?t():addEventListener(document,"DOMContentLoaded",t)}(),module.exports=routes;