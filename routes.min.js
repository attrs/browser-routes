!function(t,e){"function"==typeof define&&define.amd?define(e):"object"==typeof exports&&"string"!=typeof exports.nodeName?module.exports=e():this.Routes=e()}(this,function(){function t(t,e){if(!t||"string"!=typeof t)throw new TypeError("illegal url");var r=(e||document).createElement("a");return r.href=t,{href:r.href,protocol:r.protocol,hostname:r.hostname,port:r.port,pathname:r.pathname,fullpath:r.pathname+(r.search?r.search:"")+(r.hash?r.hash:""),search:r.search,hash:r.hash,host:r.host}}function e(t){return"/"===t[t.length-1]?t.substring(0,t.length-1):t.substring(0,t.lastIndexOf("/"))||"/"}function r(t,e){var r=document.head.querySelector('meta[name="'+t+'"][content]');return r&&r.getAttribute("content")||e}function n(t){t=t.trim(),"?"===t[0]&&(t=t.substring(1));for(var e,r=/\+/g,n=/([^&=]+)=?([^&]*)/g,o=function(t){return decodeURIComponent(t.replace(r," "))},u={};e=n.exec(t);){var i=o(e[1]),s=o(e[2]);Array.isArray(u[i])?u[i].push(s):u[i]?(u[i]=[u[i]]).push(s):u[i]=s}return u}function o(t,e,r,n){t.attachEvent?t.attachEvent(e,r):t.addEventListener(e,r,n)}function u(t,e){return t===e}function i(t,e,r,n,o){var u,i=0;return u=function(s){var f=n[i++];if(s||!f)return o(s);var h=f.uri,c=f.type,a=f.fn;if("use"===c&&h){var l=e.purl,p=e.url;e.purl=h.substring(0,h.length),e.url=e.url.substring(h.length)||"/",a.apply(t,[e,r,u]),e.purl=l,e.url=p}else a.apply(t,[e,r,u])}}function s(t){t=t||"unknwon";var e=!0,r=[],n={},o=function(t,n,s){s=s||function(){};var f=[];r.forEach(function(r){if(e||!r.boot)if("use"===r.type){if(!r.uri||!t.url.indexOf(r.uri)||u(t.url,r.uri))return f.push(r)}else if("get"===r.type&&u(t.url,r.uri))return f.push(r)}),t.boot=e,i(o,t,n,f,s)(t.error),e=!1};return o.exists=function(t){var e=!1;return r.forEach(function(r){if("get"===r.type&&u(t,r.uri))return e=!0;if("use"===r.type&&r.uri&&!t.indexOf(r.uri)){if("function"!=typeof r.fn.exists)return e=u(t,r.uri);e=r.fn.exists(t.substring(r.uri.length))}}),e},o.use=function(t,e){if("function"==typeof t&&(e=t,t=null),t&&"string"!=typeof t)throw new TypeError("illegal type of uri:"+typeof t);if("function"!=typeof e)throw new TypeError("illegal type of router:"+typeof e);return r.push({type:"use",uri:t,fn:e}),this},o.get=function(t,e){if("string"!=typeof t)throw new TypeError("illegal type of uri:"+typeof t);if("function"!=typeof e)throw new TypeError("illegal type of router:"+typeof e);return r.push({type:"get",uri:t,fn:e}),this},o.boot=function(t){if("function"!=typeof t)throw new TypeError("illegal type of router:"+typeof t);return r.push({type:"use",boot:!0,fn:t}),this},o.notfound=function(t){return o.on("notfound",t),this},o.error=function(t){return o.on("error",t),this},o.drop=function(t){var e=[];return r.forEach(function(r){r.fn===t&&e.push(r)}),e.forEach(function(t){r.splice(r.indexOf(t),1)}),this},o.clear=function(){return r=[],this},o.on=function(t,e){return n[t]=n[t]||[],n[t].push(e),this},o.once=function(t,e){var r=function(n){return o.off(t,r),e.call(this,n)};return o.on(t,r),this},o.off=function(t,e){var r=n[t];if(r)for(var o;~(o=r.indexOf(e));)r.splice(o,1);return this},o.fire=function(t,e){return"error"!==t||n[t]&&isteners[t].length?void(n[t]||[]).forEach(function(r){r.call(this,{type:t,detail:e||{}})}):console.error("[routes] error",e)},o}function f(r){if(!(this instanceof f))throw new Error("illegal state: 'new Routes()' instead of 'Routes()'");r=r||{};var o,u,i,h=this,c="",a=s("root");this.config=function(t,e){var n=r;return 1===arguments.length?n(t):(null===e?delete n[t]:n[t]=e,this)},this.base=function(r){return arguments.length?r?("/"!==r[r.length-1]&&(r+="/"),c=e(t(r).pathname),this):(c="",this):c},this.router=function(t){return s(t)},this.redirect=function(e){if(!e)throw new TypeError("missing url");return"/"!==e[0]&&(e="/"+e),e=t(c+e),a.fire("redirect",{request:o,url:e.fullpath}),h.exec(e.fullpath),this},this.exec=function(e){var r=t(e),s=r.hash,f=r.search,h=r.pathname,l=r.fullpath;return o&&o.requestURL&&l===o.requestURL?void 0:h.indexOf(c)?console.error("given url is not sub url of base url '"+c.dirname+"'"):(h=h.substring(c.length),i=[],o={method:"get",parsed:r,baseURL:c,requestURL:l,url:h,hashname:s,query:n(f),params:{}},u={redirect:this.redirect,hash:function(t,e){i.push({hash:t,fn:e})}},a(o,u),this)},this.exechash=function(){return this},this.use=function(t,e){return a.use.apply(a,arguments),this},this.boot=function(t){return a.boot(t),this},this.get=function(t,e){return a.get(t,e),this},this.notfound=function(t){return a.notfound(t),this},this.error=function(t){return a.error(t),this},this.drop=function(t){return a.drop(t),this},this.exists=function(t){return a.exists(t)},this.clear=function(){return a.clear(),this},this.on=function(t,e){return a.on(t,e),this},this.once=function(t,e){return a.once(t,e),this},this.off=function(t,e){return a.off(t,e),this}}var h=new f;return h.Routes=f,h.Router=s,function(){function t(){function t(t){return t.__routes_managed__||(t.__routes_managed__=!0,o(t,"click",function(e){e.preventDefault(),h.href(t.getAttribute("href"))})),this}function e(){return[].forEach.call(document.querySelectorAll("[routes], [data-routes]"),t),this}u&&u.disconnect(),u=new MutationObserver(function(e){e.forEach(function(e){[].forEach.call(e.addedNodes,function(e){1===e.nodeType&&(e.hasAttribute("routes")&&t(e),e.hasAttribute("data-routes")&&t(e),e.querySelectorAll&&[].forEach.call(e.querySelectorAll("[routes], [data-routes]"),t))})})}),u.observe(document.body,{childList:!0,subtree:!0}),e(),h.exec(location.href)}var e=r("routes.mode")||(history.pushState?"pushstate":"hash");if("pushstate"===e){if(!history.pushState)return console.error("[routes] unsupported 'history.pushState'");var n=history.pushState;history.pushState=function(t,e,r){n.apply(history,arguments),h.exec(location.href)},window.onpopstate=function(t){h.href(location.href)},h.on("redirect",function(t){n.call(history,null,null,t.detail.url)}),h.href=function(t){history.pushState(null,null,t)}}else if("hash"===e){if(!("onhashchange"in window))return console.error("[routes] unsupported 'onhashchange'");o(window,"hashchange",function(){h.exec(location.hash)}),h.on("redirect",function(t){location.href="#"+t.detail.url}),h.href=function(t){location.href="#"+t}}var u;document.body?t():o(document,"DOMContentLoaded",t)}(),h});